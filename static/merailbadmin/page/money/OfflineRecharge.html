<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>账单</title>
    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=318"/>
    <script src="../../assets/js/moment.js"></script>

    <style>

        .currSerachBtn {
            box-shadow: 0 15px 18px -6px rgb(45 140 240 / 65%) !important;
        }

        .currReloadBtn {
            box-shadow: 0 15px 18px -6px rgb(146 109 222 / 65%) !important;
        }

        .layui-table-cell {
            height: 36px;
            line-height: 36px;
        }


    </style>

    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!-- 正文开始 -->
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-body">


            <!-- 表格工具栏 -->
            <form class="layui-form toolbar">
                <div class="layui-form-item" style="margin-left: -40px">
                    <div class="layui-inline">
                        <label class="layui-form-label">用户名:</label>
                        <div class="layui-input-inline">
                            <input name="username" class="layui-input" placeholder="请输入用户名"/>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">订单号:</label>
                        <div class="layui-input-inline">
                            <input name="order_num" class="layui-input" placeholder="请输入订单号"/>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">三方订单号:</label>
                        <div class="layui-input-inline">
                            <input name="three_order_num" class="layui-input" placeholder="请输入三方订单号"/>
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">状态:</label>
                        <div class="layui-input-inline">
                            <select name="status" id="status">
                                <option value="999">所有类型</option>
                                <option value="1">待支付</option>
                                <option value="2">已到账</option>
                                <option value="3">已上分</option>
                                <option value="4">支付超时</option>
                            </select>
                        </div>
                    </div>
                    <div class="layui-inline" style="margin-left: 20px">&emsp;
                        <button class="layui-btn icon-btn currSerachBtn" lay-filter="userTbSearch" lay-submit>
                            <i class="layui-icon">&#xe615;</i>搜索
                        </button>
                        <button class="layui-btn icon-btn currReloadBtn" lay-filter="reloadData" lay-submit
                                style="background-color: #926dde;border-color: #926dde;">
                            <i class="layui-icon layui-icon-refresh"></i>刷新数据
                        </button>
                    </div>
                </div>
            </form>
            <!-- 数据表格 -->
            <table id="userTable" lay-filter="userTable" style="margin-top:10px"></table>
        </div>
    </div>
</div>


<!-- js部分 -->
<script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
<script type="text/javascript" src="../../assets/js/common.js?v=318"></script>

<script type="text/javascript" src="../../assets/js/jquery.min.js"></script>
<script type="text/javascript" src="../../assets/js/jquery.cookie.min.js"></script>
<script type="text/javascript" src="../../assets/js/config.url.js"></script>

<!--数据表格操作工具栏-->
<script type="text/html" id="orderListBar">
    {{#  if(d.Status !== 3){ }}
    <a class="layui-btn layui-btn-sm " lay-event="retrieveBtn" style="background-color: #11a983;"><i class="layui-icon">&#xe65c;</i>拉回</a>
<!--    {{#  } else if(d.Status == 1){ }}-->

    {{#  } }}
    <!--    <a class="layui-btn layui-btn-xs " lay-event="changebtn"><i class="layui-icon">&#xe605;</i>修改</a>-->
    <!--    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="delbtn"><i class="layui-icon">&#x1006;</i>删除</a>-->
</script>
<script>

    var mybck = $.cookie('tokenMyb');
    //alert(document.cookie);
    //console.log(mybck)
    if (mybck == "" || mybck == null) {

        window.top.location.href = "../../login.html";

    } else {

        var currDateVal
        layui.use(['layer', 'form', 'table', 'util', 'admin', 'xmSelect', 'laydate'], function () {
            var $ = layui.jquery;
            var layer = layui.layer;
            var form = layui.form;
            var table = layui.table;
            var util = layui.util;
            var admin = layui.admin;
            var laydate = layui.laydate;
            var xmSelect = layui.xmSelect;

            //常规用法
            laydate.render({
                elem: '#buildDate'
                // ,value: currDate
                , isInitValue: true
                , theme: 'molv'
                , done: function (value, date) {//选中后的回调
                    // layer.alert('你选择的日期是：' + value + '<br>获得的对象是' + JSON.stringify(date));
                    // console.log("自带的",date)
                    // console.log("jquery",$("#buildDate").val())
                    currDateVal = ""
                    currDateVal = value
                }
            });


            var log_login_request_param = {};
            log_login_request_param['on_line']= '2';
            // log_login_request_param['token']= $.cookie('tokenMyb');


            /* 渲染表格 */
            var insTb = table.render({
                elem: '#userTable',
                url: global_requestAddress + global_requestAddress_js_onLineRecharge + "?action=select",
                headers: {
                    token: mybck
                },
                method: 'post',
                where: log_login_request_param,
                response: {
                    statusCode: 2000,
                    dataName: 'result',
                },
                // toolbar: ['<p>',
                //     '<button lay-event="add" class="layui-btn layui-btn-sm icon-btn"><i class="layui-icon">&#xe654;</i>添加</button>&nbsp;',
                //     '<button lay-event="del" class="layui-btn layui-btn-sm layui-btn-danger icon-btn"><i class="layui-icon">&#xe640;</i>删除</button>',
                //     '</p>'].join(''),
                cellMinWidth: 100,
                page: { //支持传入 laypage 组件的所有参数（某些参数除外，如：jump/elem） - 详见文档
                    layout: ['limit', 'count', 'prev', 'page', 'next', 'skip'] //自定义分页布局
                    //,curr: 5 //设定初始在第 5 页
                    , groups: 10 //只显示 1 个连续页码
                    , first: "首页" //不显示首页
                    , last: "尾页"//不显示尾页
                },
                height: "full-150",
                limit: 15,
                limits: [15, 30, 50, 100],
                // id : "systemLog",
                cols: [[
                    {type: 'checkbox'},
                    {field: 'ID', title: 'ID', sort: true, align: "center"},
                    {field: 'OrderNum', title: '订单号', width: 200, sort: true, align: "center"},
                    {field: 'ThreeOrderNum', title: '平台订单号', width: 200, sort: true, align: "center"},
                    {field: 'UserName', title: '充值账号', sort: true, align: "center"},
                    {field: 'TopAgent', title: '顶级代理', sort: true, align: "center"},
                    {
                        field: 'PayChannel', title: '充值渠道', sort: true, align: "center", templet: function (d) {
                            return d.PayChannel.Name
                        }
                    },
                    {field: 'Money', title: '拉起金额', sort: true, align: "center"},
                    {field: 'AuthenticityMoney', title: '实际金额', sort: true, align: "center"},
                    {field: 'SystemMoney', title: '系统金额', sort: true, align: "center"},
                    {
                        field: 'Status', title: '状态', sort: true, align: "center", width: 130, templet: function (d) {
                            if (d.Status == "1") {//待支付
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #faa64b;border-color: #faa64b;">' + '待支付' + '</button>'
                            } else if (d.Status == "2") {//已到账
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #926dde ;border-color: #926dde ;">' + '已到账 ' + '</button>'
                            } else if (d.Status == "3") {//已上分
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #33cabb;border-color: #33cabb;">' + '已上分' + '</button>'
                            } else if (d.Status == "4") {//支付超时
                                return '<button class="layui-btn  layui-btn-sm" style="background-color: #465161;border-color: #465161;">' + '支付超时' + '</button>'
                            } else {
                                return ''
                            }
                        }
                    },
                    {
                        field: 'Artificial', title: '是否人工', sort: true, align: "center", templet: function (d) {
                            if (d.Artificial === 2) {
                                return '<button class="layui-btn  layui-btn-xs" style="background-color: #009688;border-color: #009688;">' + '是' + '</button>'
                            } else if (d.Artificial === 1) {
                                return '<button class="layui-btn  layui-btn-xs" style="background-color: #ff5722;border-color: #ff5722;">' + '否' + '</button>'
                            }
                        }
                    },
                    {field: 'RejectReason', title: '驳回原因', sort: true, align: "center"},
                    {field: 'PayFailReason', title: '三方回调', width: 180, sort: true, align: "center"},
                    {field: 'Remark', title: '备注', sort: true, align: "center"},
                    {
                        field: 'Created', width: 180, title: '创建时间', align: "center", templet: function (d) {
                            // return util.toDateString(d.Created* 1000);
                            return moment(d.Created * 1000).utc().utcOffset(currTimeZoneValue).format('YYYY-MM-DD HH:mm:ss');

                        }, sort: true
                    },
                    {
                        field: 'Updated', width: 180, title: '修改时间', align: "center", templet: function (d) {
                            // return util.toDateString(d.Updated* 1000);
                            return moment(d.Updated * 1000).utc().utcOffset(currTimeZoneValue).format('YYYY-MM-DD HH:mm:ss');

                        }, sort: true
                    },
                    // {title: '操作', width: 180, templet: '#orderListBar', fixed: "right", align: "center"}
                ]],
                done: function (res, curr, count) {
                    $('tr').css({'background-color': '#fff', 'color': '#191a1c'});
                }
            });

            /* 表格搜索 */
            var bet_tb_this;
            var currTempObj = {};
            form.on('submit(userTbSearch)', function (data) {
                // console.log("datafield",data.field);

                currTempObj = {}
                currTempObj.on_line = 2
                if (data.field.username == "") {

                } else {
                    currTempObj.username = data.field.username
                }

                if (data.field.order_num == "") {

                } else {
                    currTempObj.order_num = data.field.order_num
                }

                if (data.field.three_order_num == "") {

                } else {
                    currTempObj.three_order_num = data.field.three_order_num
                }


                if (data.field.status == "999") {


                } else {
                    currTempObj.status = data.field.status
                }


                //2.6.0之前清除保留之前的数据的最有用的方式
                if (bet_tb_this != null) {
                    // console.log("book_tb_this--不为null",bet_tb_this)
                    bet_tb_this.where = {};  //置空where
                }
                if (data.field.status == "999") {
                    insTb.reload({
                        where: currTempObj,
                        done: function () {
                            bet_tb_this = this;
                            // console.log("book_tb_this----重载后的值",bet_tb_this)
                        }
                    }, false);

                } else {


                    insTb.reload({
                        where: currTempObj
                        , page: {curr: 1},
                        done: function () {
                            bet_tb_this = this;
                            // console.log("book_tb_this----重载后的值",bet_tb_this)
                        }
                    });
                }

                return false;
            });

            /* 表格工具条点击事件 */
            table.on('tool(userTable)', function (obj) {
                var currDatas = obj.data;
                if (obj.event === 'auditBtn') { // 审核

                    jsondata = JSON.stringify(currDatas)
                    var index = layui.layer.open({
                        area: ['1000px', '500px'],
                        fixed: false, //不固定
                        maxmin: false,
                        title: "审核提现",
                        skin: 'layui-layer-rim',//加上边框
                        type: 2,
                        content: "withdraw_review.html",
                        success: function (layero, index) {
                            var body = layui.layer.getChildFrame('body', index);

                            if (currDatas) {

                            }

                        },
                        end: function () {//弹窗关闭后的回调函数
                            //利用laypage实现局部刷新,以下两种方式都可以
                            // $(".layui-laypage-btn").click()
                            //直接刷新当前修改的行
                            $(".layui-laypage-btn")[0].click()

                        }
                    })
                    window.sessionStorage.setItem("index", index);
                    //改变窗口大小时，重置弹窗的宽高，防止超出可视区域（如F12调出debug的操作）
                    $(window).on("resize", function () {
                        layui.layer.full(window.sessionStorage.getItem("index"));
                    })

                } else if (obj.event === 'retrieveBtn') { // 取回
                    jsondata = JSON.stringify(currDatas)
                    var index = layui.layer.open({
                        area: ['500px', '500px'],
                        fixed: false, //不固定
                        maxmin: false,
                        title: " 驳回提现",
                        skin: 'layui-layer-rim',//加上边框
                        type: 2,
                        content: "onLineRecharge_retrieve.html",
                        success: function (layero, index) {
                            var body = layui.layer.getChildFrame('body', index);

                            if (currDatas) {

                            }

                        },
                        end: function () {//弹窗关闭后的回调函数
                            //利用laypage实现局部刷新,以下两种方式都可以
                            // $(".layui-laypage-btn").click()
                            //直接刷新当前修改的行
                            $(".layui-laypage-btn")[0].click()

                        }
                    })
                    window.sessionStorage.setItem("index", index);
                    //改变窗口大小时，重置弹窗的宽高，防止超出可视区域（如F12调出debug的操作）
                    $(window).on("resize", function () {
                        layui.layer.full(window.sessionStorage.getItem("index"));
                    })
                } else if (obj.event === 'payBtn') { // 代付
                    jsondata = JSON.stringify(currDatas)
                    var index = layui.layer.open({
                        area: ['1000px', '500px'],
                        fixed: false, //不固定
                        maxmin: false,
                        title: " 代付提现",
                        skin: 'layui-layer-rim',//加上边框
                        type: 2,
                        content: "withdraw_pay.html",
                        success: function (layero, index) {
                            var body = layui.layer.getChildFrame('body', index);

                            if (currDatas) {

                            }

                        },
                        end: function () {//弹窗关闭后的回调函数
                            //利用laypage实现局部刷新,以下两种方式都可以
                            // $(".layui-laypage-btn").click()
                            //直接刷新当前修改的行
                            $(".layui-laypage-btn")[0].click()

                        }
                    })
                    window.sessionStorage.setItem("index", index);
                    //改变窗口大小时，重置弹窗的宽高，防止超出可视区域（如F12调出debug的操作）
                    $(window).on("resize", function () {
                        layui.layer.full(window.sessionStorage.getItem("index"));
                    })
                }
            });


        });

    }


</script>
</body>
</html>
