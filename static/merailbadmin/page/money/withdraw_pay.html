<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=318"/>
    <script src="../../assets/js/moment.js"></script>
    <!-- js部分 -->
    <script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
    <script type="text/javascript" src="../../assets/js/common.js?v=318"></script>

    <script type="text/javascript" src="../../assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../assets/js/jquery.cookie.min.js"></script>
    <script type="text/javascript" src="../../assets/js/config.url.js"></script>
    <style>
        .flexDiv{
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }
    </style>
</head>
<body class="childrenBody">
<form class="layui-form" style="margin-top: 20px">
    <div style="padding: 0 30px;display: flex;flex-direction: column">
        <div style="width: 100%;">
            <div style="display: flex;align-items: center;justify-content: space-between;">
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 30%">
                    <div style="width: 100px;text-align: right">提现账号</div>
                    <div style="margin-left: 20px" id="UserName"></div>
                </div>
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 40%">
                    <div style="width: 100px;text-align: right">顶级代理</div>
                    <div style="margin-left: 20px"  id="TopAgent"></div>
                </div>
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 30%">
                    <div style="width: 100px;text-align: right">是否人工</div>
                    <div style="margin-left: 20px"  id="Artificial"></div>
                </div>
            </div>
            <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 10px">
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 30%">
                    <div style="width: 100px;text-align: right">订单日期</div>
                    <div style="margin-left: 20px"  id="Created"></div>
                </div>
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 40%">
                    <div style="width: 100px;text-align: right">订单号</div>
                    <div style="margin-left: 20px"  id="OrderNum"></div>
                </div>
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 30%">
                    <div style="width: 100px;text-align: right">提现金额</div>
                    <div style="margin-left: 20px" id="Money"></div>
                </div>
            </div>
            <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 10px">
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 30%">
                    <div style="width: 100px;text-align: right">手续汇率</div>
                    <div style="margin-left: 20px" id="WithdrawalHand"></div>
                </div>
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 40%">
                    <div style="width: 100px;text-align: right">手续费</div>
                    <div style="margin-left: 20px" id="WithdrawalHandMoney"></div>
                </div>
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 30%">
                    <div style="width: 100px;text-align: right">实际金额</div>
                    <div style="margin-left: 20px" id="actualMoney"></div>
                </div>
            </div>
            <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 10px">
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 30%">
                    <div style="width: 100px;text-align: right">汇率</div>
                    <div style="margin-left: 20px" id="huivnum"></div>
                </div>
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 40%">
                    <div style="width: 100px;text-align: right">汇率后金额</div>
                    <div style="margin-left: 20px" id="huivmoney"></div>
                </div>
                <div style="display: flex;align-items: center;justify-content: flex-start;width:30%">
                    <div style="width: 100px;text-align: right">三方订单号</div>
                    <div style="margin-left: 20px" id="ThreeOrderNum"></div>
                </div>
            </div>
            <div style="display: flex;align-items: center;justify-content: space-between;margin-top: 10px">
                <div style="display: flex;align-items: center;justify-content: flex-start;width: 30%">
                    <div style="width: 100px;text-align: right">三方回调</div>
                    <div style="margin-left: 20px" id="PayFailReason"></div>
                </div>
            </div>
        </div>
       <div style="margin-top: 10px">
           <div>
               银行卡
           </div>
           <table class="layui-table" lay-skin="line">
                <colgroup>
                    <col/>
                    <col/>
                    <col/>
                    <col/>
                    <col/>
                </colgroup>
                <thead>
                <tr>
                    <td align="center">ID</td>
                    <td align="center">银行名</td>
                    <td align="center">银行编码</td>
                    <td align="center">卡号</td>
                    <td align="center">手机号</td>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td align="center"><span id="bankID">进行中</span></td>
                    <td align="center"><span id="BankName">进行中</span></td>
                    <td align="center"><span id="BankCode">进行中</span></td>
                    <td align="center"><span id="Card">进行中</span></td>
                    <td align="center"><span id="Phone">进行中</span></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div  style="margin-top: 10px;display: flex;align-items: center;justify-content: space-between">
            <div style="display: flex;align-items: center;justify-content: center">
                <div>
                    代付渠道
                </div>
                <div style="width: 50%;margin-left: 20px">
                    <select name="pay_filter" id="pay_filter" lay-filter="pay_filter">
                    </select>
                </div>

            </div>
            <div class="flexDiv" style="display: none" id="rejectDiv" >
                <div>
                    驳回原因
                </div>
                <div style="margin-left: 20px">
                    <input type="text" class="layui-input " id="rejectInput" placeholder="请在此输入驳回原因">
                </div>
            </div>
        </div>

        <div class="flexDiv" style="margin-top: 10px">
            <button class="layui-btn layui-btn-lg" lay-filter="comfireEdit" id="comfireEdit">确认</button>
            <button class="layui-btn layui-btn-lg layui-btn-primary" lay-filter="cancelAdd" id="cancelAdd">取消</button>
        </div>
    </div>


</form>


<script>

    var mybck = $.cookie('tokenMyb');
    if (mybck == "" || mybck == null) {


        window.top.location.href = "../../login.html";

    } else {
        var currParentDatas = eval('(' + parent.jsondata + ')')
        var cu_data_paren = eval('('+parent.cu_data+')')

        var returnDataArray = []
        var selectPayID;
        var selectPayType;

        $("#UserName").text(currParentDatas.UserName)
        $("#TopAgent").text(currParentDatas.TopAgent)
        $("#Artificial").text(currParentDatas.Artificial)
        $("#Created").text(moment(currParentDatas.Created * 1000).utc().utcOffset(cu_data_paren.countryStr).format('YYYY-MM-DD HH:mm:ss'))
        $("#OrderNum").text(currParentDatas.OrderNum)
        $("#Money").text(currParentDatas.Money)
        $("#ThreeOrderNum").text(currParentDatas.ThreeOrderNum)


        $("#bankID").text(currParentDatas.BankCardInformation.ID)
        $("#BankName").text(currParentDatas.BankCardInformation.BankName)
        $("#BankCode").text(currParentDatas.BankCardInformation.BankCode)
        $("#Card").text(currParentDatas.BankCardInformation.Card)
        $("#Phone").text(currParentDatas.BankCardInformation.Phone)


        layui.use(['layer', 'form', 'table', 'util', 'admin', 'xmSelect', 'notice'], function () {
            var $ = layui.jquery;
            var layer = layui.layer;
            // var layer = parent.layer === undefined ? layui.layer : top.layer;
            var form = layui.form;
            var table = layui.table;
            var util = layui.util;
            var admin = layui.admin;
            var xmSelect = layui.xmSelect;
            var notice = layui.notice;


            //获取VIP列表添加到下拉框中
            let  reqParam = {};
            reqParam.status = 1
            reqParam.page = 1
            reqParam.limit = 3000
            reqParam.operation = "getPaidChannels"
            reqParam.bank_name = "STP"

            $.ajax({
                url: global_requestAddress + global_requestAddress_js_withdraw + "?action=select",
                headers: {
                    "token": mybck
                },
                dataType: 'json',
                type: 'post',
                data: reqParam,
                success: function (res) {
                    if (res.code === 2000) {
                        returnDataArray = res.result
                        $("#pay_filter").empty();
                        // $('#country_filter').append(new Option('全部', '999999'));// 下拉菜单里添加元素
                        $.each(returnDataArray, function (index, item) {
                            $('#pay_filter').append(new Option(item.name, item.id));// 下拉菜单里添加元素
                        });


                        selectPayID = returnDataArray[0].id
                        selectPayType =  returnDataArray[0].pay_type

                        // //利用val值来设置的时候
                        // $('#country_filter').val(returnDataArray[0])

                        //重新渲染 固定写法
                        form.render("select");
                    }
                }
            })


            //获取配置数据添加到下拉框中
            var param = {};
            $.ajax({
                url: global_requestAddress + global_requestAddress_js_systemParameter + "?action=select",
                headers: {
                    "token": mybck
                },
                dataType: 'json',
                type: 'post',
                data: param,
                success: function (res) {
                    if (res.code === 2000) {
                        var returnDataArray = res.result

                        let withdrawalHandStr = returnDataArray.WithdrawalHand +"%"
                        $("#WithdrawalHand").text(withdrawalHandStr)
                        let withdrawalHandMoneyStr = currParentDatas.Money * (returnDataArray.WithdrawalHand/100)
                        $("#WithdrawalHandMoney").text(withdrawalHandMoneyStr)
                        let actualMoneyStr = currParentDatas.Money - withdrawalHandMoneyStr
                        $("#actualMoney").text(actualMoneyStr)

                    }
                }
            })



            //下拉框选择事件
            form.on("select(pay_filter)",function(data){
                //选择的select对象值；
                selectPayID = data.value;
                returnDataArray.forEach(item=>{
                    if(item.id == selectPayID){
                        selectPayType = item.pay_type
                    }
                })

            })


            //确认按钮点击事件
            $("#comfireEdit").click(function () {

                var param = {};
                if(!selectPayID || !selectPayType ){
                    notice.msg('请选择代付渠道!', {icon: 2});
                }

                param['id'] = currParentDatas.ID;
                param['status'] = 5;
                param['pay_channels_id'] = selectPayID;
                param['pay_type'] = selectPayType;

                $.ajax({
                    url: global_requestAddress + global_requestAddress_js_withdraw + "?action=update",
                    headers: {
                        "token": mybck,
                    },
                    data: param,
                    type: "POST",
                    dataType: "json",
                    success: function (addResult) {

                        if (addResult.code === 2000) {
                            // layer.msg(addResult.msg);
                            notice.msg(addResult.msg, {icon: 1});
                            setTimeout(function () {
                                var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                                parent.layer.close(index);
                                // window.parent.location.reload();
                            }, 1300)

                        } else {
                            notice.msg(addResult.msg, {icon: 2});
                        }

                    },
                });
                // parent.local.reload();
                return false;
            })


            //添加内容点击事件
            $("#cancelAdd").click(function () {

                // layer.msg("取消操作");
                notice.msg('取消操作!', {icon: 5});
                var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                parent.layer.close(index);
                // window.parent.location.reload();


                return false;

            })

        })
    }
</script>
</body>
</html>
