<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="stylesheet" href="../../assets/libs/layui/css/layui.css"/>
    <link rel="stylesheet" href="../../assets/module/admin.css?v=318"/>

    <!-- js部分 -->
    <script type="text/javascript" src="../../assets/libs/layui/layui.js"></script>
    <script type="text/javascript" src="../../assets/js/common.js?v=318"></script>
    <script src="../../assets/js/moment.js"></script>

    <script type="text/javascript" src="../../assets/js/jquery.min.js"></script>
    <script type="text/javascript" src="../../assets/js/jquery.cookie.min.js"></script>
    <script type="text/javascript" src="../../assets/js/config.url.js"></script>
    <style>
        /** 最新动态时间线 */
        .layui-timeline-dynamic .layui-timeline-item {
            padding-bottom: 0;
        }

        .layui-timeline-dynamic .layui-timeline-item:before {
            top: 16px;
        }

        .layui-timeline-dynamic .layui-timeline-axis {
            width: 9px;
            height: 9px;
            left: 1px;
            top: 7px;
            background-color: #cbd0db;
        }

        .layui-timeline-dynamic .layui-timeline-axis.active {
            background-color: #0c64eb;
            box-shadow: 0 0 0 2px rgba(12, 100, 235, .3);
        }

        .dynamic-card-body {
            box-sizing: border-box;
            overflow: hidden;
        }

        .dynamic-card-body:hover {
            overflow-y: auto;
            padding-right: 9px;
        }
    </style>
</head>
<body class="childrenBody">
<div class="layui-fluid">
    <div class="layui-card">
        <div class="layui-card-header">任务链</div>
        <div class="layui-card-body dynamic-card-body mini-bar" style="height: 360px;">
            <ul class="layui-timeline layui-timeline-dynamic" id="tasklist">

                <li class="layui-timeline-item">
                    <i class="layui-icon layui-timeline-axis active"></i>
                    <div class="layui-timeline-content layui-text">
                        <div class="layui-timeline-title">开始
                            <span class="pull-right">修改时间 </span></div>
                    </div>
                </li>


                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis active"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">测试组长 提交了bug 代码错误-->
                <!--                            <span class="pull-right">14:00 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">管理员 登录了系统-->
                <!--                            <span class="pull-right">13:30 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis active"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">开发一 解决了bug 代码错误-->
                <!--                            <span class="pull-right">11:30 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis active"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">测试一 创建了用例 用户登录-->
                <!--                            <span class="pull-right">11:00 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">开发二 退出了系统-->
                <!--                            <span class="pull-right">10:30 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">研发经理 指派了任务 修改大bug-->
                <!--                            <span class="pull-right">10:00 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">研发经理 指派了任务 修改小bug-->
                <!--                            <span class="pull-right">09:30 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis active"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">研发经理 指派了任务 修改小bug-->
                <!--                            <span class="pull-right">09:00 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
                <!--                <li class="layui-timeline-item">-->
                <!--                    <i class="layui-icon layui-timeline-axis"></i>-->
                <!--                    <div class="layui-timeline-content layui-text">-->
                <!--                        <div class="layui-timeline-title">管理员 登录了系统-->
                <!--                            <span class="pull-right">08:30 </span></div>-->
                <!--                    </div>-->
                <!--                </li>-->
            </ul>
        </div>
    </div>
</div>


<script>

    var mybck = $.cookie('tokenMyb');
    if (mybck == "" || mybck == null) {


        window.top.location.href = "../../login.html";

    } else {
        var currParentDatas = eval('(' + parent.jsondata + ')')



        layui.use(['layer', 'form', 'table', 'util', 'admin', 'xmSelect', 'notice', 'element'], function () {
            var $ = layui.jquery;
            var layer = layui.layer;
            // var layer = parent.layer === undefined ? layui.layer : top.layer;
            var form = layui.form;
            var table = layui.table;
            var util = layui.util;
            var admin = layui.admin;
            var xmSelect = layui.xmSelect;
            var notice = layui.notice;

            let reqParam = {}
            reqParam.user_id = currParentDatas.ID
            reqParam.operation = "history"

            $.ajax({
                url: global_requestAddress + global_requestAddress_js_user + "?action=select",
                headers: {
                    "token": mybck
                },
                data: reqParam,
                method: "post",
                dataType: "json",
                success: function (res) {
                    if (res.code === 2000) {
                        let resR = res.result
                        if(resR.length === 0){
                            var noneHtml = ""
                            noneHtml = '<li class="layui-timeline-item">'
                            noneHtml +=  ' <i class="layui-icon layui-timeline-axis"></i>'
                            noneHtml += '<div class="layui-timeline-content layui-text">'
                            noneHtml += '<div class="layui-timeline-title" >'
                            noneHtml += "无历史任务"
                            noneHtml += '<span class="pull-right">'
                            noneHtml += "--"
                            noneHtml += '</span></div></div></li>'
                            $("#tasklist").prepend(noneHtml);
                            return false
                        }


                        var contentHtml
                        var activeHtml
                        // console.log(resR.reverse())
                        let resRev = resR.reverse()
                        resRev.forEach(item => {
                            // tasklist
                            contentHtml = '<li class="layui-timeline-item">'
                            if (item.Status === 1) {//未完成
                                activeHtml = ' <i class="layui-icon layui-timeline-axis"></i>'
                            } else if (item.Status === 2) {//已完成
                                activeHtml = '<i class="layui-icon layui-timeline-axis active"></i>'
                            }
                            contentHtml += activeHtml
                            contentHtml += '<div class="layui-timeline-content layui-text">'
                            contentHtml += '<div class="layui-timeline-title" >'
                            if (item.TaskName) {
                                contentHtml += item.TaskName
                            } else {
                                contentHtml += "  " + "未命名" + "  "
                            }
                            contentHtml += '<span class="pull-right">'
                            contentHtml +=  moment(item.Updated * 1000).utc().utcOffset(currTimeZoneValue).format('YYYY-MM-DD HH:mm:ss');
                            contentHtml += '</span></div></div></li>'


                            $("#tasklist").prepend(contentHtml);

                            //
                        })
                        // console.log("contentHtml", contentHtml)
                    }
                }
            })
        })
    }
</script>
</body>
</html>
